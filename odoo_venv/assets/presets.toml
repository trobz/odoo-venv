# This file contains presets for the odoo-venv command.
#
# Available options:
#
# install_odoo (boolean):
#   Install Odoo in editable mode.
#   Default: true
#
# install_odoo_requirements (boolean):
#   Install packages from Odoo's requirement.txt.
#   Default: true
#
# ignore_from_odoo_requirements (string):
#   Comma-separated list of packages to ignore from Odoo's requirement.txt.
#
# install_addons_dirs_requirements (boolean):
#   Install requirements.txt found in addons paths.
#   Default: false
#
# ignore_from_addons_dirs_requirements (string):
#   Comma-separated list of packages to ignore from addons paths' requirement.txt.
#
# install_addons_manifests_requirements (boolean):
#   Install requirements from addons' manifests.
#   Default: false
#
# ignore_from_addons_manifests_requirements (string):
#   Comma-separated list of packages to ignore from addons' manifests.
#
# extra_requirements_file (string):
#   Path to an extra requirements file.
#
# extra_requirement (string):
#   Comma-separated list of extra packages to install.
#
# extra_commands (array of tables):
#   Additional commands to run at specific points during venv creation.
#   Each command can have a 'when' marker to conditionally run based on odoo_version.
#   Supported stages: 'after_venv', 'after_requirements', 'after_odoo_install'
#
#   Example:
#   [[common.extra_commands]]
#   command = ["uv", "pip", "install", "setuptools<58.0"]
#   when = "odoo_version <= '13.0'"
#   stage = "after_venv"
#
#   You can also set environment variables for the command:
#   [[common.extra_commands]]
#   command = ["uv", "pip", "install", "vatnumber==1.2"]
#   when = "odoo_version <= '13.0'"
#   stage = "after_venv"
#   env = { UV_NO_BUILD_ISOLATION = "1" }
#
#   Available markers in 'when' expressions:
#   - odoo_version: The Odoo version (e.g., '13.0', '14.0')
#   - python_version: The Python version (e.g., '3.7', '3.10')
#   - All standard packaging markers (sys_platform, etc.)
#
#   Marker syntax examples:
#     when = "odoo_version <= '13.0'"                          # Single condition
#     when = "odoo_version == '13.0' or odoo_version == '12.0'" # OR: runs if either is true
#     when = "odoo_version <= '13.0' and python_version >= '3.7'" # AND: runs only if both are true
#     when = "odoo_version == '13.0' or odoo_version == '14.0' and python_version == '3.8'"
#            # â†‘ Evaluates as: odoo_version == '13.0' or (odoo_version == '14.0' and python_version == '3.8')
#            # 'and' has higher precedence than 'or' (binds tighter)
#     when = ""  # Empty = always runs (same as omitting 'when')
#
#   Limitations:
#   - Parentheses NOT supported - cannot write: (a or b) and c
#   - Use precedence: 'and' binds tighter than 'or'
#

[common]

description = """
common configuration to all presets
"""

# on ubuntu 22.04/24.04, gevent fails to install with python 3.10
# that we use for odoo 16.0, 17.0, 18.0, 19.0
# see https://github.com/odoo/odoo/issues/187021

ignore_from_odoo_requirements = """
gevent==21.8.0; sys_platform != 'win32' and python_version == '3.10',
greenlet==1.1.2; sys_platform != 'win32' and python_version == '3.10',
vatnumber
"""
extra_requirement = """
gevent==22.10.2; sys_platform == 'linux' and python_version == '3.10',
greenlet==2.0.2; sys_platform == 'linux' and python_version == '3.10'
"""

# always ignore those exotic requirements unless explicitely added
ignore_from_addons_dirs_requirements = "azure-identity,mysql,mysqlclient,pymssql,cn2an"

# Install setuptools<58.0 for Odoo <= 13.0 (setuptools 58 removed 2to3 support)
[[common.extra_commands]]
command = ["uv", "pip", "install", "setuptools<58.0", "wheel"]
when = "odoo_version <= '13.0'"
stage = "after_requirements"

# Install vatnumber==1.2 for Odoo <= 13.0 with build isolation disabled
[[common.extra_commands]]
command = ["uv", "pip", "install", "vatnumber==1.2"]
when = "odoo_version <= '13.0'"
stage = "after_requirements"
env = { UV_NO_BUILD_ISOLATION = "1" }

[local]

description = """
\n- for generic venv-odooXX local venvs that we use to work on OCA modules
\n- adding some packages for dev-only purposes
"""

install_addons_dirs_requirements = true
install_addons_manifests_requirements = true
extra_requirement = "debugpy,ipython,setproctitle,watchdog,jingtrang,websocket-client,coverage,pylint-odoo,astroid,pdfminer.six,fonttools"

[demo]

description = """
- for odoo demo instances
- we install all modules requirements in advance: we don't want a user to be blocked from installing an odoo module because of a missing dep
"""

install_addons_dirs_requirements = true
install_addons_manifests_requirements = true
extra_requirement = "pdfminer.six,fonttools"

[project]

description = """
\n- for projects (any stage: dev/integration/staging/production)
\n- we want only the dependencies needed for the project to be installed, not more
"""

install_addons_dirs_requirements = false
install_addons_manifests_requirements = false
extra_requirements_file = "./requirements.txt"
extra_requirement = "pdfminer.six,fonttools"

[ci]

description = """
\n- for running tests
"""

install_addons_dirs_requirements = true
install_addons_manifests_requirements = true
extra_requirements_file = "./requirements.txt"
extra_requirement = "websocket-client,coverage,pylint,astroid,pdfminer.six,fonttools"
